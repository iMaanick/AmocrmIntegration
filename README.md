# AmoCRM ‚Üî Google Sheets Integration

## –û–ø–∏—Å–∞–Ω–∏–µ

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–¥–≤—É—Ö—Å—Ç–æ—Ä–æ–Ω–Ω—é—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é** –º–µ–∂–¥—É Google Sheets –∏ AmoCRM:

- **Google Sheets ‚Üí AmoCRM**
    - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —Å–æ–∑–¥–∞—ë—Ç —Å–¥–µ–ª–∫—É –≤ AmoCRM;
    - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–¥–µ–ª–∫—É.

- **AmoCRM ‚Üí Google Sheets**
    - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ Google Sheets.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –¥–∞–Ω–Ω—ã–µ –≤ CRM –∏ —Ç–∞–±–ª–∏—Ü–µ –≤—Å–µ–≥–¥–∞ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.

---

## üõ† –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- FastAPI
- dishka ‚Äî –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (dependency injection);
- pydantic ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö (email, —Å—É–º–º–∞);
- amocrm_api ‚Äî —Ä–∞–±–æ—Ç–∞ —Å AmoCRM REST API;
- redis ‚Äî —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É Google Sheets –∏ AmoCRM;
- gspread ‚Äî –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Google Sheets API;

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. **API (FastAPI)**

- `POST /leads/upsert` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏ –∏–∑ —Å—Ç—Ä–æ–∫–∏ Google Sheets.
- `POST /lead` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–∞ AmoCRM (–∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–¥–µ–ª–∫–∏).

### 2. **Use Cases**

- `UpsertLeadUseCase`
    - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —Å–¥–µ–ª–∫–∞ –¥–ª—è —Å—Ç—Ä–æ–∫–∏;
    - –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–ª–∏ —Å–æ–∑–¥–∞—ë—Ç —Å–¥–µ–ª–∫—É –≤ AmoCRM.
- `LeadChangedUseCase`
    - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏ –≤ AmoCRM;
    - –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ Google Sheets.

### 3. **Gateways**

- `LeadGateway` ‚Äî –æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ AmoCRM API.
- `SheetsGateway` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å Google Sheets API.
- `SheetsLeadGateway` ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–≤—è–∑–∫–∏ row_id ‚Üî lead_id (Redis).

---

## –î–æ—Å—Ç—É–ø –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

–¢–∞–∫ –∫–∞–∫ Google Apps Script –∏ AmoCRM –≤–µ–±—Ö—É–∫–∏ –Ω–µ –º–æ–≥—É—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ `localhost`, –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
—Å–µ—Ä–≤–∏—Å –¥–ª—è –ø—Ä–æ–±—Ä–æ—Å–∞ –ø–æ—Ä—Ç–∞ –Ω–∞—Ä—É–∂—É. –ù–∞–ø—Ä–∏–º–µ—Ä, **tuna**

–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å URL –≤—ã–ø–æ–ª–Ω–∏—Ç—å tuna http 8000

–ò–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç URL —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è:

- –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö Google Apps Script (–¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ API),
- –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–µ–±—Ö—É–∫–æ–≤ AmoCRM (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π).

Tuna –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å —ç—Ç–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä FastAPI (`http://localhost:8000`). –ú–æ–∂–Ω–æ
–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π —Å–µ—Ä–≤–∏—Å

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

1. –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å –¥–≤—É–º—è —Å—Ç–æ–ª–±—Ü–∞–º–∏ `email`    `amount`
   ![img.png](img.png)
2. –†–∞—Å—à–∏—Ä–µ–Ω–∏—è -> appscript -> –¥–æ–±–∞–≤–∏—Ç—å —Ç—É–¥–∞ –∫–æ–¥ –∏–∑ src/app/script.gs –∑–∞–º–µ–Ω–∏–≤ –∑–Ω–∞—á–µ–Ω–∏–µ base_url –Ω–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π URL.
   
3. –¢—Ä–∏–≥–≥–µ—Ä—ã -> –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞ -> –§—É–Ω–∫—Ü–∏—è: onEdit. –ò—Å—Ç–æ—á–Ω–∏–∫ —Å–æ–±—ã—Ç–∏—è: –ò–∑ —Ç–∞–±–ª–∏—Ü—ã. –¢–∏–ø —Å–æ–±—ã—Ç–∏—è: –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏.
   –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ: –û—Å–Ω–æ–≤–Ω–æ–µ. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö: –ø–æ –∂–µ–ª–∞–Ω–∏—é

4. –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –≤ —Ç–∞–±–ª–∏—Ü—ã —Å –ø—Ä–∞–≤–∞–º–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
5. –î–æ–±–∞–≤–∏—Ç—å –≤–µ–±—Ö—É–∫ –≤ amocrm –Ω–∞ —Å–æ–±—ã—Ç–∏–µ "–°–¥–µ–ª–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∞" —Å URL "URL/lead"
6. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

```
https://github.com/iMaanick/AmocrmIntegration.git
```

7. –î–æ–±–∞–≤—å—Ç–µ —Ñ–∞–π–ª .env –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ .example.env. GOOGLE_SPREADSHEET_URL - —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É,
   GOOGLE_SPREADSHEET_NAME - –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞
8. –í—ã–ø–æ–ª–Ω–∏—Ç–µ docker-compose -f docker-compose.yaml up --build